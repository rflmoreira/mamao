<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HypeFit - Seu aplicativo de treinos personalizados">
    <title>HypeFit - Treinos Personalizados</title>
    <!-- Bibliotecas Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Ícones -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <style>
        /* ==========================================
           ESTILOS BASE
        ========================================== */
        body {
            font-family: 'Inter', sans-serif;
            padding-bottom: 100px;
        }

        /* ==========================================
           CUSTOMIZAÇÃO DA BARRA DE ROLAGEM
        ========================================== */
        ::-webkit-scrollbar { 
            width: 8px; 
            height: 8px; 
        }
        
        ::-webkit-scrollbar-track { 
            background: #111827; 
        }
        
        ::-webkit-scrollbar-thumb { 
            background: #f97316; 
            border-radius: 10px; 
        }
        
        ::-webkit-scrollbar-thumb:hover { 
            background: #fb923c; 
        }

        /* ==========================================
           ANIMAÇÕES
        ========================================== */
        .workout-list-enter { 
            animation: fadeIn 0.5s ease-in-out; 
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1.5);
                box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.7);
            }
            50% {
                transform: scale(1.6);
                box-shadow: 0 0 0 6px rgba(249, 115, 22, 0);
            }
        }
        
        .current-week-marker-animation {
            animation: pulse 2s infinite;
        }

        @keyframes stripe-animation {
            from { background-position: 0 0; }
            to { background-position: 28px 0; }
        }

        .progress-bar-striped {
            background-image: repeating-linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.2) 0,
                rgba(255, 255, 255, 0.2) 10px,
                transparent 10px,
                transparent 20px
            );
            background-size: 28px 28px;
            animation: stripe-animation 1s linear infinite;
        }

        /* ==========================================
        /* ==========================================
           ESTILOS DOS COMPONENTES
        ========================================== */
        
        /* Tooltip */
        .step-tooltip { 
            visibility: hidden; 
            opacity: 0; 
            transition: opacity 0.3s; 
        }
        
        .group:hover .step-tooltip { 
            visibility: visible; 
            opacity: 1; 
        }
        
        /* Finalização de Exercício */
        .exercise-completed {
            opacity: 0.6;
            background-color: #1f2937;
        }
        
        .exercise-completed h3 {
            text-decoration: line-through;
        }

        /* Checkbox Animado */
        .animated-check-container {
            width: 32px;
            height: 32px;
            cursor: pointer;
        }

        .animated-check-svg {
            width: 100%;
            height: 100%;
        }

        .animated-check-circle {
            stroke: #4b5563;
            stroke-width: 3;
            fill: rgba(75, 85, 99, 0.2);
            transition: stroke 0.4s ease, fill 0.4s ease;
        }

        .animated-check-path {
            stroke: #ffffff;
            stroke-width: 4;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
            stroke-dasharray: 24;
            stroke-dashoffset: 24;
            transition: stroke-dashoffset 0.4s 0.1s ease-in-out;
        }

        .animated-check-container.completed .animated-check-circle {
            stroke: #16a34a;
            fill: rgba(22, 163, 74, 0.2);
        }

        .animated-check-container.completed .animated-check-path {
            stroke-dashoffset: 0;
        }

        /* Fundo do Cabeçalho */
        .header-background {
            background-image: url('imagens/ambitious-studio-rick-barrett-lTTjG469mHk-unsplash.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            margin-left: calc(-50vw + 50%);
            margin-right: calc(-50vw + 50%);
            margin-top: calc(-1rem - 1.5rem);
            width: 100vw;
            padding-left: calc(50vw - 50%);
            padding-right: calc(50vw - 50%);
            padding-top: 1rem;
        }
        
        .header-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                to bottom,
                rgba(17, 24, 39, 0.7) 0%,
                rgba(17, 24, 39, 0.7) 70%,
                rgba(17, 24, 39, 0.9) 85%,
                rgba(17, 24, 39, 1) 100%
            );
            z-index: 1;
        }
        
        .header-background > * {
            position: relative;
            z-index: 2;
        }

        /* ==========================================
           DESIGN RESPONSIVO
        ========================================== */
        @media (max-width: 768px) {
            #stepper-nav {
                overflow-x: hidden;
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            
            .step-tooltip {
                font-size: 9px;
                padding: 1px 4px;
                margin-bottom: 4px;
            }
            
            #day-selector {
                padding: 0.375rem;
                gap: 0.125rem;
            }
            
            #day-selector button {
                font-size: 11px;
                padding: 0.375rem 0.25rem;
            }
            
            .header-background::before {
                background: linear-gradient(
                    to bottom,
                    rgba(17, 24, 39, 0.6) 0%,
                    rgba(17, 24, 39, 0.7) 60%,
                    rgba(17, 24, 39, 0.85) 75%,
                    rgba(17, 24, 39, 0.95) 90%,
                    rgba(17, 24, 39, 1) 100%
                );
            }
        }

        @media (max-height: 680px) {
            #edit-schedule-modal {
                padding-top: 1rem;
                padding-bottom: 1rem;
            }
            
            #edit-schedule-card {
                max-height: calc(100vh - 2rem);
                display: flex;
                flex-direction: column;
            }
            
            #edit-schedule-list {
                overflow-y: auto;
                flex-shrink: 1;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- ==========================================
         CONTAINER PRINCIPAL DO CONTEÚDO
    ========================================== -->
    <div id="main-content" class="container mx-auto p-4 md:p-6 max-w-4xl transition-all duration-500">

        <!-- Seção do Cabeçalho -->
        <header class="text-center mb-10 header-background py-12">
            <div class="flex justify-center items-center h-32">
                <img src="imagens\HypeFit.png" 
                     alt="HyperFit Logo" 
                     class="h-24 md:h-32 w-auto drop-shadow-lg"
                     loading="lazy">
            </div>
        </header>

        <!-- Cabeçalho da Fase -->
        <section id="phase-header" class="text-center mb-6" role="banner">
            <!-- Conteúdo dinâmico será inserido aqui -->
        </section>

        <!-- Navegação por Semana -->
        <nav class="bg-gray-800 p-2 rounded-lg mb-8" aria-label="Navegação por semanas">
            <div id="stepper-nav" class="py-2 overflow-hidden">
                <!-- Navegador dinâmico será inserido aqui -->
            </div>
        </nav>

        <!-- Seletor de Dia/Treino -->
        <nav id="day-selector" 
             class="flex justify-center items-center gap-1 md:gap-2 mb-8 bg-gray-800 p-2 rounded-lg overflow-hidden" 
             aria-label="Seleção de dia de treino">
             <!-- Abas dinâmicas dos dias serão inseridas aqui -->
        </nav>
        
        <!-- Container do Treino Atual -->
        <main id="current-workout-container" class="workout-list-enter">
            <header id="workout-title" class="text-center mb-4 min-h-[32px]"></header>
            <div id="progress-bar-container" class="mb-6 px-2"></div>
            <section id="workout-details" class="space-y-4">
                <!-- Lista dinâmica de exercícios será inserida aqui -->
            </section>
        </main>
    </div>

    <!-- ==========================================
         SEÇÃO DO RODAPÉ
    ========================================== -->
    <footer id="footer-container" class="fixed bottom-0 left-0 right-0 p-4 z-40">
        <div class="container mx-auto max-w-4xl">
            <button id="complete-workout-btn" 
                    class="w-full bg-gray-600/80 backdrop-blur-sm text-white font-bold py-3 px-6 rounded-3xl text-lg hover:bg-gray-500 disabled:bg-gray-600/80 disabled:backdrop-blur-sm disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-2xl shadow-black/50"
                    aria-label="Concluir treino atual">
                 <i class='ph-bold ph-checks text-2xl' aria-hidden="true"></i>
                Concluir Treino
            </button>
        </div>
    </footer>
    
    <!-- ==========================================
         ELEMENTOS FLUTUANTES
    ========================================== -->
    
    <!-- Canvas de Confete -->
    <canvas id="confetti-canvas" 
            class="fixed top-0 left-0 w-full h-full pointer-events-none z-[100]" 
            aria-hidden="true"></canvas>

    <!-- Botão do Player de Música -->
    <button id="open-player-btn" 
            class="fixed top-1/2 right-0 -translate-y-1/2 mr-4 md:mr-6 bg-orange-600/80 backdrop-blur-sm text-white w-16 h-16 rounded-full shadow-2xl hover:bg-orange-500 z-40 flex items-center justify-center cursor-grab active:cursor-grabbing"
            aria-label="Abrir player de música">
        <i class='ph-fill ph-music-notes-simple text-2xl' aria-hidden="true"></i>
    </button>

    <!-- ==========================================
         MODAIS
    ========================================== -->
    
    <!-- Modal do Player de Música -->
    <div id="player-modal" 
         class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center p-4 opacity-0 invisible transition-opacity duration-500"
         role="dialog" 
         aria-labelledby="player-title" 
         aria-hidden="true">
         
        <div id="player-card" class="w-full max-w-sm bg-gray-800/50 border border-white/10 backdrop-blur-xl rounded-2xl shadow-2xl p-6 transform scale-95 transition-all duration-500 relative">
            <!-- Capa do Álbum -->
            <img id="album-art" 
                 src="imagens/EDM.png" 
                 alt="Capa do Álbum" 
                 class="w-full rounded-lg shadow-lg aspect-square"
                 loading="lazy">

            <!-- Informações da Música -->
            <div class="text-center mt-6">
                <h2 id="song-title" class="text-2xl font-bold">EDM</h2>
                <p id="song-artist" class="text-md text-white/60 mt-1">Sunshine-Live.de</p>
            </div>

            <!-- Controles de Reprodução -->
            <div class="flex items-center justify-center gap-6 mt-8">
                <button id="play-pause-btn" 
                        class="bg-orange-600/80 backdrop-blur-sm text-white w-16 h-16 rounded-full shadow-2xl hover:bg-orange-500 flex items-center justify-center"
                        aria-label="Reproduzir/Pausar música">
                    <i id="play-icon" class='ph-fill ph-play text-3xl' aria-hidden="true"></i>
                    <i id="stop-icon" class='ph-fill ph-stop text-3xl hidden' aria-hidden="true"></i>
                </button>
            </div>

            <!-- Botão Fechar -->
            <button id="close-player-btn" 
                    class="absolute bottom-4 right-4 bg-red-600/80 backdrop-blur-sm text-white w-12 h-12 rounded-full shadow-2xl hover:bg-red-500 flex items-center justify-center z-10"
                    aria-label="Fechar player">
                <i class='ph-bold ph-x text-2xl' aria-hidden="true"></i>
            </button>
        </div>
    </div>
    
    <!-- Modal de Edição da Programação -->
    <div id="edit-schedule-modal" 
         class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center p-4 opacity-0 invisible transition-opacity duration-500"
         role="dialog" 
         aria-labelledby="edit-title" 
         aria-hidden="true">
         
        <div id="edit-schedule-card" class="w-full max-w-sm bg-gray-800/50 border border-white/10 backdrop-blur-xl rounded-2xl shadow-2xl p-4 transform scale-95 transition-all duration-500">
            <h2 id="edit-title" class="text-xl font-bold text-center text-orange-400 mb-3">Editar Treinos</h2>
            <div id="edit-schedule-list" class="space-y-2">
                <!-- Conteúdo dinâmico será inserido aqui -->
            </div>
            <div class="flex justify-end gap-3 mt-4">
                <button id="cancel-edit-btn" 
                        class="px-5 py-2 bg-gray-600/80 hover:bg-gray-500/80 rounded-lg font-semibold transition-colors text-sm"
                        aria-label="Cancelar edição">
                    Cancelar
                </button>
                <button id="save-edit-btn" 
                        class="px-5 py-2 bg-orange-600 hover:bg-orange-500 rounded-lg font-bold text-white transition-colors text-sm"
                        aria-label="Salvar alterações">
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- ==========================================
         ELEMENTO DE ÁUDIO
    ========================================== -->
    <audio id="audio-player" 
           src="https://stream.sunshine-live.de/edm/mp3-128/" 
           preload="none"
           aria-label="Player de áudio para música EDM"></audio>

    <script>
        // ==========================================
        // CONFIGURAÇÃO E DADOS DA APLICAÇÃO
        // ==========================================
        
        /**
         * Configuração das Fases de Treino
         * Contém todos os dados de treino organizados por fases, semanas e detalhes dos exercícios
         */
        const WORKOUT_PHASES = {
            "phase1": { title: "Fase 1: Adaptação", weeks: [1], schedule: { "Seg": "A", "Ter": "B", "Qua": "C", "Qui": "A", "Sex": "B", "Sáb": "OFF", "Dom": "OFF" }, workouts: { "A": { name: "Treino A - Puxar", exercises: [ { name: "Pulley Frente Aberto", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Puxada Triângulo", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Convencional" }, { name: "Remada Serrote", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Convencional" }, { name: "Remada Baixa Triângulo", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Convencional" }, { name: "Rosca Direta Barra Reta", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Tríceps Corda", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Rosca Martelo + Tríceps Francês (Corda)", series: "3", rept: "15 a 20", descanso: "1 Min", method: "BI-SET" } ] }, "B": { name: "Treino B - Pernas", exercises: [ { name: "Cadeira Extensora", series: "3", rept: "8 a 12", descanso: "90 seg", method: "Convencional" }, { name: "Leg Press 45", series: "3", rept: "8 a 12", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Adutora", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Extensora (2)", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Flexora", series: "4", rept: "8 a 12", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Abdutora", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" } ] }, "C": { name: "Treino C - Empurrar", exercises: [ { name: "Supino Inclinado Máquina", series: "3", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Crucifixo Inclinado", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Isometria" }, { name: "Supino Reto Máquina", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Desenvolvimento Máquina Aberto", series: "3", rept: "8 a 12", descanso: "60 seg", method: "Conv+Isometria" }, { name: "Elevação Lateral", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Tríceps Paralela", series: "3", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Tríceps Corda", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Convencional" } ] } } },
            "phase2": { title: "Fase 2: Aumento de Volume", weeks: [2, 3, 4, 5, 6], schedule: { "Seg": "A", "Ter": "B", "Qua": "C", "Qui": "OFF", "Sex": "D", "Sáb": "E", "Dom": "OFF" }, workouts: { "A": { name: "Treino A - Ombros", exercises: [ { name: "Desenvolvimento Máquina", series: "4", rept: "20/18/15/12", descanso: "1 Min", method: "Pirâmide Crescente" }, { name: "Elevação Lateral na Polia", series: "4", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Elevação Lateral com Halter", series: "4", rept: "15 a 20", descanso: "1 Min", method: "Drop Set 1 descida" }, { name: "Elevação Frontal na Polia", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Elevação Frontal Barra", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Convencional" }, { name: "Crucifixo Inverso Máquina", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Pull Face", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Drop Set 1 descida" } ] }, "B": { name: "Treino B - Quadríceps", exercises: [ { name: "Cadeira Extensora", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Leg Press 45", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Agachamento Hack", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Cadeira Adutora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Drop Set 1 descida" }, { name: "Panturrilha em Pé Máquina", series: "6", rept: "15 a 20", descanso: "45 seg", method: "Convencional" } ] }, "C": { name: "Treino C - Costas e Bíceps", exercises: [ { name: "Puxada Frente Aberta", series: "4", rept: "20/18/15/12", descanso: "60 seg", method: "Pirâmide Crescente" }, { name: "Barra Fixa", series: "3", rept: "Falha", descanso: "60 seg", method: "Convencional" }, { name: "Remada na Máquina Articulada", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Remada Baixa Triângulo", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" }, { name: "Remada Pronada na Máquina", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Rosca Direta Barra W", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Rosca Scott na Máquina com Barra W", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" } ] }, "D": { name: "Treino D - Peito e Tríceps", exercises: [ { name: "Supino Inclinado Máquina", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Pirâmide Crescente" }, { name: "Crucifixo Inclinado", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Supino Reto Máquina", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Crucifixo Máquina Reto", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" }, { name: "Tríceps Paralela", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Tríceps Corda", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" } ] }, "E": { name: "Treino E - Posterior e Glúteo", exercises: [ { name: "Mesa Flexora", series: "3", rept: "8 a 12", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Flexora", series: "4", rept: "12 a 15", descanso: "90 seg", method: "Drop Set 1 descida" }, { name: "Stiff", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Cadeira Abdutora", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Elevação Pélvica com Barra", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Panturrilha em Pé Máquina", series: "5", rept: "15 a 20", descanso: "90 seg", method: "Convencional" } ] } } },
            "phase3": { title: "Fase 3: Mais Volume e Técnicas", weeks: [7, 8, 9, 10], schedule: { "Seg": "A", "Ter": "B", "Qua": "C", "Qui": "OFF", "Sex": "D", "Sáb": "E", "Dom": "OFF" }, workouts: { "A": { name: "Treino A - Ombros", exercises: [ { name: "Desenvolvimento Máquina", series: "4", rept: "20/18/15/12", descanso: "1 Min", method: "Pirâmide Crescente" }, { name: "Elevação Lateral na Polia", series: "4", rept: "8 a 12", descanso: "1 Min", method: "Rest Pause Última Série" }, { name: "Elevação Lateral com Halter", series: "4", rept: "15 a 20", descanso: "1 Min", method: "Drop Set Todas as Séries" }, { name: "Elevação Frontal na Polia", series: "4", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Elevação Frontal Barra", series: "4", rept: "15 a 20", descanso: "1 Min", method: "Rest Pause Última Série" }, { name: "Crucifixo Inverso Máquina", series: "4", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Pull Face", series: "4", rept: "15 a 20", descanso: "1 Min", method: "Drop Set Todas as Séries" } ] }, "B": { name: "Treino B - Quadríceps", exercises: [ { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Leg Press 45", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Agachamento Hack", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Agachamento Smith", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Cadeira Adutora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Drop Set Todas as Séries" }, { name: "Panturrilha em Pé Máquina", series: "6", rept: "15 a 20", descanso: "45 seg", method: "Convencional" } ] }, "C": { name: "Treino C - Costas e Bíceps", exercises: [ { name: "Puxada Frente Aberta", series: "4", rept: "20/18/15/12", descanso: "60 seg", method: "Pirâmide Crescente" }, { name: "Barra Fixa", series: "4", rept: "Falha", descanso: "60 seg", method: "Rest Pause Última Série" }, { name: "Remada na Máquina Articulada", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Remada Baixa Triângulo", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set Todas as Séries" }, { name: "Remada Pronada na Máquina", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Rosca Direta Barra W", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Rosca Scott na Máquina com Barra W", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Rest Pause Última Série" }, { name: "Rosca Spider com Barra W", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Drop Set Todas as Séries" } ] }, "D": { name: "Treino D - Peito e Tríceps", exercises: [ { name: "Supino Inclinado Máquina", series: "4", rept: "20/18/15/12", descanso: "60 seg", method: "Pirâmide Crescente" }, { name: "Crucifixo Inclinado", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Supino Reto Máquina", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Crucifixo Máquina Reto", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" }, { name: "Tríceps Francês Corda", series: "3", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Tríceps Paralela", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Rest Pause Última Série" }, { name: "Tríceps Corda", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set Todas as Séries" } ] }, "E": { name: "Treino E - Posterior e Glúteo", exercises: [ { name: "Mesa Flexora", series: "4", rept: "8 a 12", descanso: "90 seg", method: "Rest Pause Última Série" }, { name: "Cadeira Flexora", series: "4", rept: "12 a 15", descanso: "90 seg", method: "Drop Set Todas as Séries" }, { name: "Stiff", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Cadeira Abdutora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Rest Pause Última Série" }, { name: "Elevação Pélvica com Barra", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Panturrilha em Pé Máquina", series: "5", rept: "15 a 20", descanso: "90 seg", method: "Convencional" } ] } } },
            "phase4": { title: "Fase 4: Método MAIS CINCO", weeks: [11, 12], schedule: { "Seg": "A", "Ter": "B", "Qua": "C", "Qui": "OFF", "Sex": "D", "Sáb": "E", "Dom": "OFF" }, workouts: { "A": { name: "Treino A - Ombros", exercises: [ { name: "Desenvolvimento Máquina", series: "4", rept: "20/18/15/12", descanso: "90 Seg", method: "Pirâmide + MAIS CINCO" }, { name: "Elevação Lateral Polia", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Elevação Lateral com Halter", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Elevação Frontal na Polia", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Elevação Frontal Barra", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Crucifixo Inverso Máquina", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Pull Face", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" } ] }, "B": { name: "Treino B - Quadríceps", exercises: [ { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Leg Press 45", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Agachamento Hack", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Agachamento Smith", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Cadeira Adutora", series: "4", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Panturrilha em Pé Máquina", series: "6", rept: "15 a 20", descanso: "45 seg", method: "MAIS CINCO" } ] }, "C": { name: "Treino C - Costas e Bíceps", exercises: [ { name: "Puxada Frente Aberta", series: "4", rept: "20/18/15/12", descanso: "90 Seg", method: "Pirâmide + MAIS CINCO" }, { name: "Barra Fixa", series: "4", rept: "Falha", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Remada na Máquina Articulada", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Remada Baixa Triângulo", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Remada Pronada na Máquina", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Rosca Direta Barra W", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Rosca Scott na Máquina com Barra W", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Rosca Spider com Barra W", series: "3", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" } ] }, "D": { name: "Treino D - Peito e Tríceps", exercises: [ { name: "Supino Inclinado Máquina", series: "4", rept: "20/18/15/12", descanso: "90 Seg", method: "Pirâmide + MAIS CINCO" }, { name: "Crucifixo Inclinado", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Supino Reto Máquina", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Crucifixo Máquina Reto", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Tríceps Francês Corda", series: "3", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Tríceps Paralela", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Tríceps Corda", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" } ] }, "E": { name: "Treino E - Posterior e Glúteo", exercises: [ { name: "Mesa Flexora", series: "4", rept: "8 a 12", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Cadeira Flexora", series: "4", rept: "12 a 15", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Stiff", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Cadeira Abdutora", series: "4", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Elevação Pélvica com Barra", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Panturrilha em Pé Máquina", series: "5", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" } ] } } }
        };

        /**
         * Gerenciamento do Estado da Aplicação
         * Estado centralizado para a aplicação de treinos
         */
        const APP_STATE = {
            currentWeekNumber: 1,
            currentDay: 'Seg',
            highestUnlockedWeek: 1,
            highestUnlockedDayIndex: 0, 
            completionStatus: {},
            allCompletions: {}
        };

        /**
         * Referências dos Elementos DOM
         * Elementos DOM cacheados para melhor performance
         */
        const DOM_ELEMENTS = {
            mainContent: document.getElementById('main-content'),
            stepperNav: document.getElementById('stepper-nav'),
            daySelector: document.getElementById('day-selector'),
            workoutDetails: document.getElementById('workout-details'),
            workoutTitle: document.getElementById('workout-title'),
            progressBarContainer: document.getElementById('progress-bar-container'),
            phaseHeader: document.getElementById('phase-header'),
            footer: document.getElementById('footer-container'),
            completeWorkoutBtn: document.getElementById('complete-workout-btn'),
            editScheduleModal: document.getElementById('edit-schedule-modal'),
            editScheduleCard: document.getElementById('edit-schedule-card'),
            editScheduleList: document.getElementById('edit-schedule-list'),
            cancelEditBtn: document.getElementById('cancel-edit-btn'),
            saveEditBtn: document.getElementById('save-edit-btn'),
        };
        
        /**
         * Configuração do Confete
         * Configuração para animações de celebração
         */
        const confettiCanvas = document.getElementById('confetti-canvas');
        const confettiInstance = confetti.create(confettiCanvas, {
            resize: true,
            useWorker: true
        });

        // ==========================================
        // FUNÇÕES UTILITÁRIAS
        // ==========================================
        
        /**
         * Exibir mensagem de conclusão quando o programa terminar
         */
        function showCompletionMessage() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/70 flex items-center justify-center z-[200] p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-8 text-center border border-gray-700 shadow-2xl animate-fadeIn">
                    <h2 class="text-3xl font-bold text-orange-500 mb-4">Parabéns!</h2>
                    <p class="text-white text-lg mb-6">Você concluiu o programa de 12 semanas!</p>
                    <button id="close-modal-btn" class="bg-orange-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-orange-700">Fechar</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Confetes contínuos
            let confettiInterval;
            
            // Inicia celebração contínua de confete
            const fireConfetti = () => {
                confettiInstance({
                    particleCount: 150,
                    spread: 90,
                    origin: { y: 0.6 },
                    colors: ['#f97316', '#fb923c', '#fed7aa', '#ffffff']
                });
            };
            
            fireConfetti();
            confettiInterval = setInterval(fireConfetti, 3000);
            
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                clearInterval(confettiInterval);
                modal.remove();
            });
        }
        
        /**
         * Resetar o estado da aplicação para os valores iniciais
         */
        function resetApplicationState() {
            localStorage.removeItem('workoutProgress');
            localStorage.removeItem('customSchedules');
            APP_STATE.currentWeekNumber = 1;
            APP_STATE.currentDay = 'Seg';
            APP_STATE.highestUnlockedWeek = 1;
            APP_STATE.highestUnlockedDayIndex = 0;
            APP_STATE.completionStatus = {};
            APP_STATE.allCompletions = {};
            console.warn("Application state was reset due to invalid saved data.");
            // Recarrega dados originais se a função for chamada
            Object.assign(WORKOUT_PHASES, JSON.parse(JSON.stringify(originalWorkoutPhases)));
        }

        // ==========================================
        // GERENCIAMENTO DE ESTADO
        // ==========================================
        
        /**
         * Salvar o estado atual da aplicação no localStorage
         */
        function saveApplicationState() {
            localStorage.setItem('workoutProgress', JSON.stringify({
                highestUnlockedWeek: APP_STATE.highestUnlockedWeek,
                highestUnlockedDayIndex: APP_STATE.highestUnlockedDayIndex,
                allCompletions: APP_STATE.allCompletions
            }));
            
            // Salva apenas os horários modificados
            const customSchedules = {};
            for (const phaseKey in WORKOUT_PHASES) {
                customSchedules[phaseKey] = WORKOUT_PHASES[phaseKey].schedule;
            }
            localStorage.setItem('customSchedules', JSON.stringify(customSchedules));
        }

        /**
         * Carregar o estado da aplicação do localStorage
         */
        function loadApplicationState() {
            // Carrega horários personalizados
            const savedSchedulesJSON = localStorage.getItem('customSchedules');
            if (savedSchedulesJSON) {
                try {
                    const savedSchedules = JSON.parse(savedSchedulesJSON);
                    for (const phaseKey in savedSchedules) {
                        if (WORKOUT_PHASES[phaseKey]) {
                            WORKOUT_PHASES[phaseKey].schedule = savedSchedules[phaseKey];
                        }
                    }
                } catch (e) {
                    console.error("Error loading custom schedules. Using defaults.", e);
                }
            }

            // Carrega dados de progresso
            try {
                const savedStateJSON = localStorage.getItem('workoutProgress');
                if (!savedStateJSON) return;

                const savedState = JSON.parse(savedStateJSON);
                
                if (typeof savedState !== 'object' || savedState === null ||
                    typeof savedState.highestUnlockedWeek !== 'number' ||
                    typeof savedState.highestUnlockedDayIndex !== 'number') {
                    throw new Error("Invalid state structure.");
                }
                
                let week = savedState.highestUnlockedWeek;
                if (week < 1 || week > 12) {
                     throw new Error("Invalid week number.");
                }

                const phaseData = getPhaseDataByWeek(week);
                if (!phaseData) {
                    throw new Error(`Phase data not found for week ${week}.`);
                }

                const dayKeys = Object.keys(phaseData.schedule);
                let dayIndex = savedState.highestUnlockedDayIndex;
                if (dayIndex < 0 || dayIndex >= dayKeys.length) {
                    dayIndex = 0;
                }
                
                APP_STATE.highestUnlockedWeek = week;
                APP_STATE.currentWeekNumber = week;
                APP_STATE.highestUnlockedDayIndex = dayIndex;
                APP_STATE.currentDay = dayKeys[dayIndex];
                APP_STATE.allCompletions = savedState.allCompletions || {};
                loadCurrentCompletionStatus();

            } catch (error) {
                console.error("Failed to load or validate state from localStorage. Resetting.", error);
                resetApplicationState();
            }
        }
        
        /**
         * Obter dados da fase para um número específico de semana
         * @param {number} weekNumber - O número da semana para obter dados da fase
         * @returns {Object|null} Objeto de dados da fase ou null se não encontrado
         */
        function getPhaseDataByWeek(weekNumber) {
            for (const phaseKey in WORKOUT_PHASES) {
                const phase = WORKOUT_PHASES[phaseKey];
                if (phase.weeks.includes(weekNumber)) {
                    return phase;
                }
            }
            return null;
        }
        
        /**
         * Obter chave da fase para um número específico de semana
         * @param {number} weekNumber - O número da semana para obter a chave da fase
         * @returns {string|null} Chave da fase ou null se não encontrada
         */
        function getPhaseKeyByWeek(weekNumber) {
            for (const phaseKey in WORKOUT_PHASES) {
                if (WORKOUT_PHASES[phaseKey].weeks.includes(weekNumber)) {
                    return phaseKey;
                }
            }
            return null;
        }

        /**
         * Carregar status de conclusão para a semana e dia atuais
         */
        function loadCurrentCompletionStatus() {
            const key = `week${APP_STATE.currentWeekNumber}-${APP_STATE.currentDay}`;
            APP_STATE.completionStatus = APP_STATE.allCompletions[key] || {};
        }

        // ==========================================
        // FUNÇÕES DE RENDERIZAÇÃO
        // ==========================================
        
        /**
         * Renderizar o navegador de navegação por semanas
         */
        function renderStepperNavigation() {
            DOM_ELEMENTS.stepperNav.innerHTML = '';
            const container = document.createElement('div');
            container.className = 'relative w-full px-1 md:px-2';

            const track = document.createElement('div');
            track.className = 'absolute top-1/2 -translate-y-1/2 left-0 w-full h-1 bg-gray-700 rounded-full';
            container.appendChild(track);

            const progressFill = document.createElement('div');
            const progressPercentage = APP_STATE.highestUnlockedWeek > 1 ? 
                ((APP_STATE.highestUnlockedWeek - 1) / 11) * 100 : 0;
            progressFill.className = 'absolute top-1/2 -translate-y-1/2 left-0 h-1 bg-orange-500 rounded-full transition-all duration-500';
            progressFill.style.width = `${progressPercentage}%`;
            container.appendChild(progressFill);

            const markersContainer = document.createElement('div');
            markersContainer.className = 'relative flex justify-between items-center px-1 md:px-0';
            
            for (let i = 1; i <= 12; i++) {
                const weekNumber = i;
                const isLocked = weekNumber > APP_STATE.highestUnlockedWeek;
                
                const markerWrapper = document.createElement('div');
                markerWrapper.className = `group relative flex flex-col items-center p-0.5 md:p-2 ${isLocked ? 'cursor-not-allowed' : 'cursor-pointer'}`;
                
                if (!isLocked) {
                    markerWrapper.addEventListener('click', () => {
                        APP_STATE.currentWeekNumber = weekNumber;
                        const newPhaseData = getPhaseDataByWeek(weekNumber);
                        const dayKeys = Object.keys(newPhaseData.schedule);
                        APP_STATE.currentDay = weekNumber === APP_STATE.highestUnlockedWeek ? 
                            dayKeys[APP_STATE.highestUnlockedDayIndex] : dayKeys[0];
                        loadCurrentCompletionStatus();
                        renderAllComponents();
                    });
                }

                const marker = document.createElement('div');
                let markerClasses = 'w-1.5 h-1.5 md:w-3 md:h-3 rounded-full transition-all duration-300 flex items-center justify-center';
                
                if (weekNumber === APP_STATE.currentWeekNumber) {
                    if (weekNumber === 12) {
                        markerClasses += ' bg-white border-2 border-yellow-500 scale-150 ring-2 ring-yellow-300';
                        marker.innerHTML = `<i class='ph-fill ph-trophy text-yellow-500 text-xs md:text-sm'></i>`;
                        markerClasses += ' w-3 h-3 md:w-6 md:h-6';
                    } else {
                        markerClasses += ' bg-orange-500 border-2 border-orange-400 scale-150 current-week-marker-animation';
                    }
                } else if (weekNumber < APP_STATE.highestUnlockedWeek) {
                    markerClasses += ' bg-gray-800 border-2 border-orange-500';
                } else {
                    markerClasses += isLocked ? ' bg-gray-800 border-2 border-gray-600' : ' bg-gray-600';
                }
                
                if(isLocked) {
                    if(weekNumber === 12) {
                        marker.innerHTML = `<i class='ph-fill ph-trophy text-yellow-500 text-xs md:text-sm'></i>`;
                    } else {
                        marker.innerHTML = `<i class='ph-fill ph-lock-key text-gray-500 text-xs md:text-sm'></i>`;
                    }
                    markerClasses += ' w-3 h-3 md:w-6 md:h-6';
                }
                marker.className = markerClasses;
                
                const tooltip = document.createElement('span');
                tooltip.className = 'step-tooltip absolute bottom-full mb-2 px-2 py-1 text-xs font-semibold text-white bg-gray-700 rounded-md whitespace-nowrap';
                tooltip.textContent = `Semana ${weekNumber}`;
                
                markerWrapper.appendChild(tooltip);
                markerWrapper.appendChild(marker);
                markersContainer.appendChild(markerWrapper);
            }
            
            container.appendChild(markersContainer);
            DOM_ELEMENTS.stepperNav.appendChild(container);
        }

        /**
         * Renderizar o cabeçalho da fase com título e informações da semana
         */
        function renderPhaseHeader() {
            const phaseData = getPhaseDataByWeek(APP_STATE.currentWeekNumber);
            if (!phaseData) return;
            
            DOM_ELEMENTS.phaseHeader.innerHTML = `
                <h2 class="text-3xl md:text-4xl font-black text-orange-400 tracking-tight">${phaseData.title}</h2>
                <p class="text-lg text-gray-400 font-semibold mt-1">Semana ${APP_STATE.currentWeekNumber} de 12</p>
            `;
        }

        /**
         * Renderizar o seletor de dias com os dias de treino
         */
        function renderDaySelector() {
            const phaseData = getPhaseDataByWeek(APP_STATE.currentWeekNumber);
            const dayKeys = Object.keys(phaseData.schedule);
            DOM_ELEMENTS.daySelector.innerHTML = '';

            dayKeys.forEach((day, index) => {
                const isInUnlockedWeek = APP_STATE.currentWeekNumber <= APP_STATE.highestUnlockedWeek;
                const workoutLetter = phaseData.schedule[day];
                const button = document.createElement('button');
                button.textContent = day;
                let buttonClasses = `px-2 md:px-3 py-1.5 text-xs md:text-sm rounded-md font-semibold transition-colors duration-200 flex-1 text-center min-w-0 `;

                if (!isInUnlockedWeek || workoutLetter === 'OFF') {
                    buttonClasses += 'bg-gray-800 text-gray-500 cursor-not-allowed';
                    button.disabled = true;
                } else if (APP_STATE.currentDay === day) {
                    buttonClasses += 'bg-orange-600 text-white';
                } else {
                    buttonClasses += 'bg-gray-700 text-gray-400 hover:bg-gray-600';
                }

                button.className = buttonClasses;

                if (isInUnlockedWeek && workoutLetter !== 'OFF') {
                    button.addEventListener('click', () => {
                        APP_STATE.currentDay = day;
                        loadCurrentCompletionStatus();
                        renderWorkoutDetails();
                        renderDaySelector();
                    });
                }
                DOM_ELEMENTS.daySelector.appendChild(button);
            });

            // Adiciona botão de edição
            const editButton = document.createElement('button');
            editButton.id = 'edit-schedule-btn';
            editButton.className = `flex-shrink-0 flex items-center justify-center p-1 rounded-md text-gray-400 hover:bg-gray-600 hover:text-orange-400 transition-colors duration-200`;
            editButton.innerHTML = `<i class="ph-bold ph-pencil-simple text-base"></i>`;
            editButton.title = 'Editar treinos da semana';
            editButton.addEventListener('click', openEditModal);
            DOM_ELEMENTS.daySelector.appendChild(editButton);
        }

        /**
         * Renderizar detalhes do treino e lista de exercícios
         */
        function renderWorkoutDetails() {
            const phaseData = getPhaseDataByWeek(APP_STATE.currentWeekNumber);
            if (!phaseData) return; 
            
            const workoutLetter = phaseData.schedule[APP_STATE.currentDay];
            DOM_ELEMENTS.workoutDetails.innerHTML = '';
            DOM_ELEMENTS.workoutTitle.innerHTML = '';
            DOM_ELEMENTS.progressBarContainer.innerHTML = '';
            DOM_ELEMENTS.footer.style.display = 'none';

            // Gerenciar dia de descanso
            if (workoutLetter === 'OFF' || !phaseData.workouts[workoutLetter]) {
                DOM_ELEMENTS.workoutTitle.innerHTML = `<h2 class="text-2xl font-bold text-gray-400">Dia de Descanso</h2>`;
                return;
            }
            
            DOM_ELEMENTS.footer.style.display = 'block';

            const workout = phaseData.workouts[workoutLetter];
            DOM_ELEMENTS.workoutTitle.innerHTML = `<h2 class="text-3xl font-bold text-white">${workout.name}</h2>`;
            
            // Calcular progresso
            const totalExercises = workout.exercises.length;
            const completedExercises = Object.values(APP_STATE.completionStatus).filter(Boolean).length;
            const progress = totalExercises > 0 ? (completedExercises / totalExercises) * 100 : 0;
            const allDone = completedExercises >= totalExercises;
            
            const isCurrentProgressDay = APP_STATE.currentWeekNumber === APP_STATE.highestUnlockedWeek &&
                               Object.keys(phaseData.schedule).indexOf(APP_STATE.currentDay) === APP_STATE.highestUnlockedDayIndex;

            DOM_ELEMENTS.completeWorkoutBtn.disabled = !isCurrentProgressDay;

            // Atualizar aparência do botão baseado no status de conclusão
            updateWorkoutButton(allDone);

            // Renderizar barra de progresso
            renderProgressBar(completedExercises, totalExercises, progress);

            // Renderizar exercícios com otimização de performance
            const fragment = document.createDocumentFragment();
            workout.exercises.forEach((exercise, index) => {
                const exerciseCard = createExerciseCard(exercise, index);
                fragment.appendChild(exerciseCard);
            });
            DOM_ELEMENTS.workoutDetails.appendChild(fragment);
        }

        /**
         * Atualizar aparência do botão de conclusão do treino
         * @param {boolean} allDone - Se todos os exercícios estão concluídos
         */
        function updateWorkoutButton(allDone) {
            if (allDone) {
                DOM_ELEMENTS.completeWorkoutBtn.classList.remove('bg-gray-600/80', 'hover:bg-gray-500');
                DOM_ELEMENTS.completeWorkoutBtn.classList.add('bg-green-600/80', 'hover:bg-green-500');
                DOM_ELEMENTS.completeWorkoutBtn.innerHTML = `<i class='ph-bold ph-arrow-right text-2xl' aria-hidden="true"></i> Avançar Treino`;
            } else {
                DOM_ELEMENTS.completeWorkoutBtn.classList.remove('bg-green-600/80', 'hover:bg-green-500');
                DOM_ELEMENTS.completeWorkoutBtn.classList.add('bg-gray-600/80', 'hover:bg-gray-500');
                DOM_ELEMENTS.completeWorkoutBtn.innerHTML = `<i class='ph-bold ph-checks text-2xl' aria-hidden="true"></i> Concluir Treino`;
            }
        }

        /**
         * Renderizar barra de progresso
         * @param {number} completedExercises - Número de exercícios concluídos
         * @param {number} totalExercises - Número total de exercícios
         * @param {number} progress - Porcentagem de progresso
         */
        function renderProgressBar(completedExercises, totalExercises, progress) {
            DOM_ELEMENTS.progressBarContainer.innerHTML = `
                <div class="flex justify-between items-center mb-1 text-sm font-semibold">
                    <span class="text-gray-400">Progresso do Treino</span>
                    <span class="text-white">${completedExercises} / ${totalExercises}</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2.5 overflow-hidden">
                    <div class="bg-orange-500 h-2.5 rounded-full transition-all duration-500 progress-bar-striped" style="width: ${progress}%"></div>
                </div>
            `;
        }

        /**
         * Criar um elemento de cartão de exercício
         * @param {Object} exercise - Dados do exercício
         * @param {number} index - Índice do exercício
         * @returns {HTMLElement} Elemento do cartão de exercício
         */
        function createExerciseCard(exercise, index) {
            const isCompleted = APP_STATE.completionStatus[index];
            const card = document.createElement('div');
            card.className = `bg-gray-800 rounded-xl shadow-lg border border-gray-700 transition-all duration-300 flex flex-col ${isCompleted ? 'exercise-completed' : ''}`;
            
            const imageUrl = getExerciseImageUrl(exercise.name);

            card.innerHTML = `
                <div class="flex-grow p-5">
                    <div class="flex flex-col items-center w-full">
                        <img src="${imageUrl}" 
                             alt="Ilustração do exercício ${exercise.name}" 
                             class="w-64 h-64 md:w-72 md:h-72 object-cover rounded-xl mb-6 shadow-xl border-4 border-orange-500/20"
                             loading="lazy">
                        <h3 class="text-2xl font-bold text-white text-center mb-6">${exercise.name}</h3>

                        <div class="w-full grid grid-cols-2 gap-3 text-center">
                            <div class="bg-gray-900/50 p-3 rounded-lg">
                                <span class="text-xs uppercase text-gray-400 font-semibold tracking-wider">Séries</span>
                                <p class="font-bold text-lg text-white">${exercise.series}</p>
                            </div>
                            <div class="bg-gray-900/50 p-3 rounded-lg">
                                <span class="text-xs uppercase text-gray-400 font-semibold tracking-wider">Reps</span>
                                <p class="font-bold text-lg text-white">${exercise.rept}</p>
                            </div>
                            <div class="bg-gray-900/50 p-3 rounded-lg">
                                <span class="text-xs uppercase text-gray-400 font-semibold tracking-wider">Descanso</span>
                                <p class="font-bold text-lg text-white">${exercise.descanso}</p>
                            </div>
                            <div class="bg-orange-600/20 text-orange-400 p-3 rounded-lg border border-orange-500/30">
                                <span class="text-xs uppercase font-semibold tracking-wider">Método</span>
                                <p class="font-bold text-lg">${exercise.method}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="completion-toggle-wrapper p-4 bg-gray-900/50 rounded-b-xl mt-auto flex items-center justify-center cursor-pointer transition-colors duration-300 hover:bg-gray-700/50" data-index="${index}">
                    <div class="animated-check-container ${isCompleted ? 'completed' : ''}">
                        <svg class="animated-check-svg" viewBox="0 0 24 24">
                            <circle class="animated-check-circle" cx="12" cy="12" r="10"/>
                            <path class="animated-check-path" d="M7 13l3 3 7-7"/>
                        </svg>
                    </div>
                    <span class="ml-3 font-bold text-lg transition-colors duration-300 ${isCompleted ? 'text-green-400' : 'text-gray-300'}">${isCompleted ? 'Concluído!' : 'Marcar como Concluído'}</span>
                </div>
            `;
            
            return card;
        }

        /**
         * Gerenciar alternância de conclusão de exercício usando delegação de eventos
         * @param {Event} event - Evento de clique
         */
        function handleExerciseToggle(event) {
            const toggleWrapper = event.target.closest('.completion-toggle-wrapper');
            if (!toggleWrapper) return;
            
            const index = parseInt(toggleWrapper.dataset.index);
            APP_STATE.completionStatus[index] = !APP_STATE.completionStatus[index];
            const key = `week${APP_STATE.currentWeekNumber}-${APP_STATE.currentDay}`;
            APP_STATE.allCompletions[key] = APP_STATE.completionStatus;
            saveApplicationState();
            renderWorkoutDetails();
        }

        /**
         * Obter URL da imagem para exercício
         * @param {string} exerciseName - Nome do exercício
         * @returns {string} URL da imagem
         */
        function getExerciseImageUrl(exerciseName) {
            // Mapeamento de imagens de exercícios
            const exerciseImageMap = {
                'Elevação Lateral na Polia': 'imagens/Elevação Lateral na Polia.gif',
                'Pulley Frente Aberto': 'imagens/Pulley Frente Aberto.gif',
                'Puxada Triângulo': 'imagens/Puxada Triângulo.gif',
                'Remada Serrote': 'imagens/Remada Serrote.gif',
                'Remada Baixa Triângulo': 'imagens/Remada Baixa Triângulo.gif',
                'Rosca Direta Barra Reta': 'imagens/Rosca Direta Barra Reta.gif',
                'Tríceps Corda': 'imagens/Tríceps Corda.gif',
                'Rosca Martelo + Tríceps Francês (Corda)': 'imagens/Rosca Martelo + Tríceps Francês (Corda).gif',
                'Desenvolvimento Máquina': 'imagens/Desenvolvimento Máquina.gif',
                'Cadeira Extensora': 'imagens/Cadeira Extensora.gif',
                'Leg Press 45': 'imagens/Leg Press 45.gif',
                'Cadeira Adutora': 'imagens/Cadeira Adutora.gif',
                'Cadeira Extensora (2)': 'imagens/Cadeira Extensora (2).gif',
                'Cadeira Flexora': 'imagens/Cadeira Flexora.gif',
                'Cadeira Abdutora': 'imagens/Cadeira Abdutora.gif',
                'Supino Inclinado Máquina': 'imagens/Supino Inclinado Máquina.gif',
                'Crucifixo Inclinado': 'imagens/Crucifixo Inclinado.gif',
                'Supino Reto Máquina': 'imagens/Supino Reto Máquina.gif',
                'Desenvolvimento Máquina Aberto': 'imagens/Desenvolvimento Máquina Aberto.gif',
                'Elevação Lateral': 'imagens/Elevação Lateral.gif',
                'Tríceps Paralela': 'imagens/Tríceps Paralela.gif',
                'Elevação Lateral com Halter': 'imagens/Elevação Lateral com Halter.gif',
                'Elevação Frontal na Polia': 'imagens/Elevação Frontal na Polia.gif',
                'Elevação Frontal Barra': 'imagens/Elevação Frontal Barra.gif',
                'Crucifixo Inverso Máquina': 'imagens/Crucifixo Inverso Máquina.gif',
                'Pull Face': 'imagens/Pull Face.gif',
                'Puxada Frente Aberta': 'imagens/Puxada Frente Aberta.gif',
                'Barra Fixa': 'imagens/Barra Fixa.gif',
                'Remada na Máquina Articulada': 'imagens/Remada na Máquina Articulada.gif',
                'Remada Pronada na Máquina': 'imagens/Remada Pronada na Máquina.gif',
                'Rosca Direta Barra W': 'imagens/Rosca Direta Barra W.gif',
                'Rosca Scott na Máquina com Barra W': 'imagens/Rosca Scott na Máquina com Barra W.gif',
                'Rosca Spider com Barra W': 'imagens/Rosca Spider com Barra W.gif',
                'Tríceps Francês Corda': 'imagens/Tríceps Francês Corda.gif',
                'Mesa Flexora': 'imagens/Mesa Flexora.gif',
                'Stiff': 'imagens/Stiff.gif',
                'Elevação Pélvica com Barra': 'imagens/Elevação Pélvica com Barra.gif',
                'Panturrilha em Pé Máquina': 'imagens/Panturrilha em Pé Máquina.gif',
                'Agachamento Hack': 'imagens/Agachamento Hack.gif',
                'Crucifixo Máquina Reto': 'imagens/Crucifixo Máquina Reto.gif',
                'Agachamento Smith': 'imagens/Agachamento Smith.gif',
                'Elevação Lateral Polia': 'imagens/Elevação Lateral Polia.gif'
            };
            
            return exerciseImageMap[exerciseName] || 
                   `https://placehold.co/100x100/1f2937/FFFFFF?text=${encodeURIComponent(exerciseName.split(' ')[0])}&font=inter`;
        }
        
        /**
         * Renderizar todos os componentes de uma vez
         */
        function renderAllComponents() {
            renderStepperNavigation();
            renderPhaseHeader();
            renderDaySelector();
            renderWorkoutDetails();
        }

        // ==========================================
        // MANIPULADORES DE EVENTOS
        // ==========================================
        
        /**
         * Gerenciar conclusão do treino e progressão
         */
        function handleWorkoutCompletion() {
            const phaseData = getPhaseDataByWeek(APP_STATE.currentWeekNumber);
            const workoutLetter = phaseData.schedule[APP_STATE.currentDay];
            const workout = phaseData.workouts[workoutLetter];
            if (!workout) return;

            const totalExercises = workout.exercises.length;
            const completedExercises = Object.values(APP_STATE.completionStatus).filter(Boolean).length;
            const isWorkoutFinished = completedExercises >= totalExercises;

            // Se o treino ainda não foi finalizado (botão cinza)
            if (!isWorkoutFinished) {
                // Marca todos os exercícios como concluídos
                workout.exercises.forEach((_, index) => {
                    APP_STATE.completionStatus[index] = true;
                });

                // Salva status de conclusão
                const key = `week${APP_STATE.currentWeekNumber}-${APP_STATE.currentDay}`;
                APP_STATE.allCompletions[key] = APP_STATE.completionStatus;
                saveApplicationState();

                // Re-renderiza a visualização do treino
                renderWorkoutDetails();
                return;
            }

            // Se o treino já foi finalizado (botão verde) - segundo clique
            confettiInstance({
                particleCount: 150,
                spread: 90,
                origin: { y: 0.6 },
                colors: ['#f97316', '#fb923c', '#fed7aa', '#ffffff']
            });
            
            const currentPhaseData = getPhaseDataByWeek(APP_STATE.currentWeekNumber);
            const dayKeys = Object.keys(currentPhaseData.schedule);
            const currentDayIndex = dayKeys.indexOf(APP_STATE.currentDay);

            let nextDayIndex = currentDayIndex + 1;
            while(nextDayIndex < dayKeys.length && currentPhaseData.schedule[dayKeys[nextDayIndex]] === 'OFF') {
                nextDayIndex++;
            }
            
            let isLastTrainingDay = !dayKeys.slice(currentDayIndex + 1).some(day => currentPhaseData.schedule[day] !== 'OFF');

            if (isLastTrainingDay) {
                if (APP_STATE.highestUnlockedWeek < 12) {
                    APP_STATE.highestUnlockedWeek++;
                    APP_STATE.highestUnlockedDayIndex = 0;
                    APP_STATE.currentWeekNumber = APP_STATE.highestUnlockedWeek;
                    const nextPhaseData = getPhaseDataByWeek(APP_STATE.currentWeekNumber);
                    APP_STATE.currentDay = Object.keys(nextPhaseData.schedule)[0];
                } else {
                    saveApplicationState();
                    showCompletionMessage();
                    return;
                }
            } else {
                 APP_STATE.highestUnlockedDayIndex = nextDayIndex;
                 APP_STATE.currentDay = dayKeys[nextDayIndex];
            }
            
            loadCurrentCompletionStatus();
            saveApplicationState();
            
            setTimeout(() => {
                renderAllComponents();
                window.scrollTo(0, 0);
            }, 300);
        }

        // ==========================================
        // FUNÇÕES DE MODAL
        // ==========================================
        
        /**
         * Abrir o modal de edição de horários
         */
        function openEditModal() {
            const phaseData = getPhaseDataByWeek(APP_STATE.currentWeekNumber);
            if (!phaseData) return;

            const schedule = phaseData.schedule;
            const workouts = phaseData.workouts;
            const workoutOptions = Object.keys(workouts);
            const dayNames = { 
                "Seg": "Segunda", "Ter": "Terça", "Qua": "Quarta", 
                "Qui": "Quinta", "Sex": "Sexta", "Sáb": "Sábado", "Dom": "Domingo" 
            };

            DOM_ELEMENTS.editScheduleList.innerHTML = '';

            Object.keys(schedule).forEach(dayKey => {
                const currentWorkout = schedule[dayKey];
                const row = document.createElement('div');
                row.className = 'grid grid-cols-5 items-center gap-2 bg-gray-900/50 px-2 py-1.5 rounded-lg';

                const label = document.createElement('label');
                label.textContent = dayNames[dayKey];
                label.className = 'font-semibold text-white text-sm col-span-2';

                const select = document.createElement('select');
                select.id = `edit-day-${dayKey}`;
                select.className = 'bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block w-full col-span-3 py-1 px-2';
                
                // Adiciona opção de dia de descanso
                const offOption = document.createElement('option');
                offOption.value = 'OFF';
                offOption.textContent = 'Dia de Descanso';
                select.appendChild(offOption);
                
                // Adiciona opções de treino
                workoutOptions.forEach(workoutKey => {
                    const option = document.createElement('option');
                    option.value = workoutKey;
                    option.textContent = `Treino ${workoutKey}`;
                    select.appendChild(option);
                });
                
                select.value = currentWorkout;
                row.appendChild(label);
                row.appendChild(select);
                DOM_ELEMENTS.editScheduleList.appendChild(row);
            });

            DOM_ELEMENTS.mainContent.classList.add('blur-sm', 'scale-105');
            DOM_ELEMENTS.editScheduleModal.classList.remove('invisible', 'opacity-0');
            DOM_ELEMENTS.editScheduleCard.classList.remove('scale-95');
        }

        /**
         * Fechar o modal de edição de horários
         */
        function closeEditModal() {
            DOM_ELEMENTS.mainContent.classList.remove('blur-sm', 'scale-105');
            DOM_ELEMENTS.editScheduleModal.classList.add('invisible', 'opacity-0');
            DOM_ELEMENTS.editScheduleCard.classList.add('scale-95');
        }

        /**
         * Salvar alterações de horário do modal
         */
        function saveScheduleChanges() {
            const phaseKey = getPhaseKeyByWeek(APP_STATE.currentWeekNumber);
            if (!phaseKey) return;

            const newSchedule = {};
            const dayKeys = Object.keys(WORKOUT_PHASES[phaseKey].schedule);
            let firstActiveDay = null;
            
            dayKeys.forEach(dayKey => {
                const select = document.getElementById(`edit-day-${dayKey}`);
                const newWorkout = select.value;
                newSchedule[dayKey] = newWorkout;
                
                // Define primeiro dia ativo para navegação
                if (newWorkout !== 'OFF' && !firstActiveDay) {
                    firstActiveDay = dayKey;
                }
            });
            
            WORKOUT_PHASES[phaseKey].schedule = newSchedule;
            
            // Verifica se o dia atual ainda é um dia de treino
            const currentWorkoutLetter = newSchedule[APP_STATE.currentDay];
            if (currentWorkoutLetter === 'OFF' || !WORKOUT_PHASES[phaseKey].workouts[currentWorkoutLetter]) {
                APP_STATE.currentDay = firstActiveDay || dayKeys[0];
            }
            
            saveApplicationState();
            renderAllComponents();
            closeEditModal();
        }

        // ==========================================
        // FUNCIONALIDADE DO PLAYER DE MÚSICA
        // ==========================================
        
        /**
         * Inicializar funcionalidade do player de música
         */
        function initializeMusicPlayer() {
            const openPlayerBtn = document.getElementById('open-player-btn');
            const closePlayerBtn = document.getElementById('close-player-btn');
            const playerModal = document.getElementById('player-modal');
            const playerCard = document.getElementById('player-card');
            const audio = document.getElementById('audio-player');
            
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playIcon = document.getElementById('play-icon');
            const stopIcon = document.getElementById('stop-icon');

            // Lógica do modal
            const openModal = () => {
                playerModal.classList.remove('invisible', 'opacity-0');
                playerCard.classList.remove('scale-95');
                DOM_ELEMENTS.mainContent.classList.add('blur-sm', 'scale-105');
            };

            const closeModal = () => {
                playerModal.classList.add('invisible', 'opacity-0');
                playerCard.classList.add('scale-95');
                DOM_ELEMENTS.mainContent.classList.remove('blur-sm', 'scale-105');
            };

            closePlayerBtn.addEventListener('click', closeModal);
            playerModal.addEventListener('click', (e) => {
                if (e.target === playerModal) {
                    closeModal();
                }
            });

            // Funcionalidade de arrastar e soltar para botão flutuante
            let isDragging = false;
            let hasDragged = false;
            let startX, startY;
            let initialLeft, initialTop;

            function dragStart(e) {
                if (e.type === 'touchstart') {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                } else {
                    e.preventDefault();
                    startX = e.clientX;
                    startY = e.clientY;
                }
                
                const rect = openPlayerBtn.getBoundingClientRect();
                initialLeft = rect.left;
                initialTop = rect.top;
                
                isDragging = true;
                hasDragged = false;
                
                openPlayerBtn.style.transition = 'none';

                window.addEventListener('mousemove', dragging);
                window.addEventListener('mouseup', dragEnd);
                window.addEventListener('touchmove', dragging, { passive: false });
                window.addEventListener('touchend', dragEnd);
            }

            function dragging(e) {
                if (!isDragging) return;
                
                if (e.type === 'touchmove') {
                    e.preventDefault();
                }

                let currentX, currentY;
                if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX;
                    currentY = e.touches[0].clientY;
                } else {
                    currentX = e.clientX;
                    currentY = e.clientY;
                }
                
                const dx = currentX - startX;
                const dy = currentY - startY;

                if (!hasDragged && (Math.abs(dx) > 5 || Math.abs(dy) > 5)) {
                    hasDragged = true;
                    if (openPlayerBtn.classList.contains('top-1/2')) {
                        openPlayerBtn.classList.remove('top-1/2', 'right-0', '-translate-y-1/2', 'mr-4', 'md:mr-6');
                        openPlayerBtn.style.top = `${initialTop}px`;
                        openPlayerBtn.style.left = `${initialLeft}px`;
                    }
                }
                
                if (hasDragged) {
                    openPlayerBtn.style.top = `${initialTop + dy}px`;
                    openPlayerBtn.style.left = `${initialLeft + dx}px`;
                }
            }

            function dragEnd() {
                if (!isDragging) return;
                isDragging = false;
                
                window.removeEventListener('mousemove', dragging);
                window.removeEventListener('mouseup', dragEnd);
                window.removeEventListener('touchmove', dragging);
                window.removeEventListener('touchend', dragEnd);
                
                if (!hasDragged) {
                    openModal();
                    return;
                }
                
                openPlayerBtn.style.transition = 'top 0.3s ease-out, left 0.3s ease-out';

                const btnRect = openPlayerBtn.getBoundingClientRect();
                const winWidth = window.innerWidth;
                const winHeight = window.innerHeight;
                const margin = 24;

                const centerX = btnRect.left + btnRect.width / 2;
                
                // Determinar posição de encaixe horizontal
                const finalLeft = (centerX < winWidth / 2) 
                    ? margin 
                    : winWidth - btnRect.width - margin;

                // Definir pontos de encaixe verticais
                const snapPointsY = [
                    margin,
                    (winHeight / 2) - (btnRect.height / 2),
                    winHeight - btnRect.height - margin
                ];

                // Encontrar ponto de encaixe vertical mais próximo
                let finalTop = snapPointsY.reduce((closest, current) => {
                    return (Math.abs(current - btnRect.top) < Math.abs(closest - btnRect.top) ? current : closest);
                });
                
                openPlayerBtn.style.top = `${finalTop}px`;
                openPlayerBtn.style.left = `${finalLeft}px`;
                openPlayerBtn.style.transform = 'none';
            }

            openPlayerBtn.addEventListener('mousedown', dragStart);
            openPlayerBtn.addEventListener('touchstart', dragStart);

            // Lógica do player de áudio
            let isPlaying = false;

            const togglePlay = () => {
                if (isPlaying) {
                    audio.pause();
                } else {
                    audio.load();
                    audio.play().catch(e => console.error("Error playing audio:", e));
                }
            };
            
            const updatePlayPauseIcon = () => {
                playIcon.classList.toggle('hidden', isPlaying);
                stopIcon.classList.toggle('hidden', !isPlaying);
            };

            // Ouvintes de eventos de áudio
            playPauseBtn.addEventListener('click', togglePlay);
            audio.addEventListener('play', () => { isPlaying = true; updatePlayPauseIcon(); });
            audio.addEventListener('pause', () => { isPlaying = false; updatePlayPauseIcon(); });

            // Define volume inicial
            audio.volume = 1.0;
        }

        // ==========================================
        // INICIALIZAÇÃO DA APLICAÇÃO
        // ==========================================
        
        /**
         * Inicializar a aplicação
         */
        function initializeApplication() {
            // Carregar estado salvo
            loadApplicationState();
            
            // Renderizar todos os componentes
            renderAllComponents();
            
            // Configurar ouvintes de eventos com performance melhorada
            setupEventListeners();
            
            // Inicializar player de música
            initializeMusicPlayer();
        }

        /**
         * Configurar todos os ouvintes de eventos para melhor performance
         */
        function setupEventListeners() {
            // Botão de ação principal
            DOM_ELEMENTS.completeWorkoutBtn.addEventListener('click', handleWorkoutCompletion);
            
            // Ouvintes de eventos do modal
            DOM_ELEMENTS.cancelEditBtn.addEventListener('click', closeEditModal);
            DOM_ELEMENTS.saveEditBtn.addEventListener('click', saveScheduleChanges);
            DOM_ELEMENTS.editScheduleModal.addEventListener('click', (e) => {
                if (e.target === DOM_ELEMENTS.editScheduleModal) {
                    closeEditModal();
                }
            });
            
            // Delegação de eventos para alternância de conclusão de exercícios
            DOM_ELEMENTS.workoutDetails.addEventListener('click', handleExerciseToggle);
        }

        // Iniciar a aplicação quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', initializeApplication);
    </script>
</body>
</html>

