<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>+5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            padding-bottom: 100px; /* Space for fixed footer */
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #f97316; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #fb923c; }
        
        /* Animations */
        .workout-list-enter { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom Tooltip */
        .step-tooltip { visibility: hidden; opacity: 0; transition: opacity 0.3s; }
        .group:hover .step-tooltip { visibility: visible; opacity: 1; }
        
        /* Completed exercise style */
        .exercise-completed {
            opacity: 0.6;
            background-color: #1f2937;
        }
        .exercise-completed h3 {
            text-decoration: line-through;
        }

        /* Custom styles for input range (volume) */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            outline: none;
            cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s;
        }
        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        input[type="range"]:hover::-webkit-slider-thumb {
            background: #f0f0f0;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div id="main-content" class="container mx-auto p-4 md:p-6 max-w-4xl transition-all duration-500">

        <!-- Header -->
        <header class="text-center mb-10">
             <div class="relative flex justify-center items-center h-32">
                <span class="absolute text-9xl md:text-[12rem] font-black text-orange-500 opacity-40 blur-3xl pointer-events-none">5</span>
                <h1 class="relative text-8xl md:text-9xl font-black text-orange-500 drop-shadow-lg z-10">
                    +5
                </h1>
            </div>
            <p class="text-gray-400 -mt-2 uppercase tracking-widest">ATÉ O LIMITE, TODO DIA.</p>
        </header>

        <!-- Week/Level Stepper -->
        <div id="stepper-nav" class="mb-12 py-4">
            <!-- Compact Stepper will be inserted here by JS -->
        </div>

        <!-- Phase Header -->
        <div id="phase-header" class="text-center mb-6">
            <!-- Phase title and week progress will be inserted here -->
        </div>

        <!-- Day/Workout Selector -->
        <div id="day-selector" class="flex flex-wrap justify-center gap-2 mb-8 bg-gray-800 p-2 rounded-lg">
             <!-- Day tabs will be inserted here by JS -->
        </div>
        
        <!-- Current Workout Container -->
        <div id="current-workout-container" class="workout-list-enter">
            <div id="workout-title" class="text-center mb-4 min-h-[32px]"></div>
            <div id="progress-bar-container" class="mb-6 px-2"></div>
            <main id="workout-details" class="space-y-4">
                <!-- Exercise checklist will be inserted here by JS -->
            </main>
        </div>
    </div>

    <!-- Fixed Footer Button -->
    <footer id="footer-container" class="fixed bottom-0 left-0 right-0 p-4 z-40">
        <div class="container mx-auto max-w-4xl">
            <button id="complete-workout-btn" class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-lg hover:bg-green-700 transition-all duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-2xl shadow-black/50">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                Concluir Treino
            </button>
        </div>
    </footer>
    
    <canvas id="confetti-canvas" class="fixed top-0 left-0 w-full h-full pointer-events-none z-[100]"></canvas>

    <!-- Floating Music Button -->
    <button id="open-player-btn" class="fixed top-1/2 right-0 -translate-y-1/2 mr-4 md:mr-6 bg-orange-600/80 backdrop-blur-sm text-white p-4 rounded-full shadow-2xl hover:bg-orange-500 transition-all duration-300 transform hover:scale-110 z-40">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-13c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 6l12 3" />
        </svg>
    </button>
    
    <!-- Music Player Modal -->
    <div id="player-modal" class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center p-4 opacity-0 invisible transition-opacity duration-500">
        <!-- Player Card -->
        <div id="player-card" class="w-full max-w-sm bg-gray-800/50 border border-white/10 backdrop-blur-xl rounded-2xl shadow-2xl p-6 transform scale-95 transition-all duration-500 relative">
            <!-- Close Button -->
            <button id="close-player-btn" class="absolute top-4 right-4 text-white/50 hover:text-white transition-colors z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>

            <!-- Album Art -->
            <img id="album-art" src="imagens/hitsbrasil.jpg" alt="Capa do Álbum" class="w-full rounded-lg shadow-lg aspect-square">

            <!-- Song Info -->
            <div class="text-center mt-6">
                <h2 id="song-title" class="text-2xl font-bold">O Canal Hits Brasil</h2>
                <p id="song-artist" class="text-md text-white/60 mt-1">Hunter.FM</p>
            </div>

            <!-- Playback Controls -->
            <div class="flex items-center justify-center gap-6 mt-8">
                <button id="play-pause-btn" class="bg-orange-500 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg transform hover:scale-110 transition-transform">
                    <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="currentColor" viewBox="0 0 16 16"><path d="M10.804 8 5 4.633v6.734L10.804 8z"/></svg>
                    <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 hidden" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"/></svg>
                </button>
            </div>

            <!-- Volume Control -->
            <div class="flex items-center gap-3 mt-8">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white/50" fill="currentColor" viewBox="0 0 16 16"><path d="M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12V4zM6.313 6.313a.5.5 0 0 1 .687 0l.875.875a.5.5 0 0 1 0 .707L7 8.586l.875.875a.5.5 0 0 1 0 .707l-.875.875a.5.5 0 0 1-.687 0l-.875-.875a.5.5 0 0 1 0-.707L6.293 8 5.418 7.125a.5.5 0 0 1 0-.707l.875-.875z"/></svg>
                <input id="volume-slider" type="range" min="0" max="1" step="0.01" value="0.5" class="w-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white/50" fill="currentColor" viewBox="0 0 16 16"><path d="M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12V4zm3.025 4a4.486 4.486 0 0 1-1.318 3.182L10 10.475A3.489 3.489 0 0 0 11.025 8 3.49 3.49 0 0 0 10 5.525l.707-.707A4.486 4.486 0 0 1 12.025 8z"/></svg>
            </div>
        </div>
    </div>
    
    <!-- Audio element for playback -->
    <audio id="audio-player" src="https://live.hunter.fm/hitsbrasil_normal"></audio>

    <script>
        const workoutPhases = {
            "phase1": { title: "Fase 1: Adaptação", weeks: [1], schedule: { "Seg": "A", "Ter": "B", "Qua": "C", "Qui": "A", "Sex": "B", "Sáb": "OFF", "Dom": "OFF" }, workouts: { "A": { name: "Treino A - Puxar", exercises: [ { name: "Pulley Frente Aberto", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Puxada Triângulo", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Convencional" }, { name: "Remada Serrote", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Convencional" }, { name: "Remada Baixa Triângulo", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Convencional" }, { name: "Rosca Direta Barra Reta", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Tríceps Corda", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Rosca Martelo + Tríceps Francês (Corda)", series: "3", rept: "15 a 20", descanso: "1 Min", method: "BI-SET" } ] }, "B": { name: "Treino B - Pernas", exercises: [ { name: "Cadeira Extensora", series: "3", rept: "8 a 12", descanso: "90 seg", method: "Convencional" }, { name: "Leg Press 45", series: "3", rept: "8 a 12", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Adutora", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Extensora (2)", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Flexora", series: "4", rept: "8 a 12", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Abdutora", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" } ] }, "C": { name: "Treino C - Empurrar", exercises: [ { name: "Supino Inclinado Máquina", series: "3", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Crucifixo Inclinado", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Isometria" }, { name: "Supino Reto Máquina", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Desenvolvimento Máquina Aberto", series: "3", rept: "8 a 12", descanso: "60 seg", method: "Conv+Isometria" }, { name: "Elevação Lateral", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Tríceps Paralela", series: "3", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Tríceps Corda", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Convencional" } ] } } },
            "phase2": { title: "Fase 2: Aumento de Volume", weeks: [2, 3, 4, 5, 6], schedule: { "Seg": "A", "Ter": "B", "Qua": "C", "Qui": "OFF", "Sex": "D", "Sáb": "E", "Dom": "OFF" }, workouts: { "A": { name: "Treino A - Ombros", exercises: [ { name: "Desenvolvimento Máquina", series: "4", rept: "20/18/15/12", descanso: "1 Min", method: "Pirâmide Crescente" }, { name: "Elevação Lateral na Polia", series: "4", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Elevação Lateral com Halter", series: "4", rept: "15 a 20", descanso: "1 Min", method: "Drop Set 1 descida" }, { name: "Elevação Frontal na Polia", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Elevação Frontal Barra", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Convencional" }, { name: "Crucifixo Inverso Máquina", series: "3", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Pull Face", series: "3", rept: "15 a 20", descanso: "1 Min", method: "Drop Set 1 descida" } ] }, "B": { name: "Treino B - Quadríceps", exercises: [ { name: "Cadeira Extensora", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Leg Press 45", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Agachamento Hack", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Cadeira Adutora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Drop Set 1 descida" }, { name: "Panturrilha em Pé Máquina", series: "6", rept: "15 a 20", descanso: "45 seg", method: "Convencional" } ] }, "C": { name: "Treino C - Costas e Bíceps", exercises: [ { name: "Puxada Frente Aberta", series: "4", rept: "20/18/15/12", descanso: "60 seg", method: "Pirâmide Crescente" }, { name: "Barra Fixa", series: "3", rept: "Falha", descanso: "60 seg", method: "Convencional" }, { name: "Remada na Máquina Articulada", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Remada Baixa Triângulo", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" }, { name: "Remada Pronada na Máquina", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Rosca Direta Barra W", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Rosca Scott na Máquina com Barra W", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" } ] }, "D": { name: "Treino D - Peito e Tríceps", exercises: [ { name: "Supino Inclinado Máquina", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Pirâmide Crescente" }, { name: "Crucifixo Inclinado", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Supino Reto Máquina", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Crucifixo Máquina Reto", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" }, { name: "Tríceps Paralela", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Tríceps Corda", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" } ] }, "E": { name: "Treino E - Posterior e Glúteo", exercises: [ { name: "Mesa Flexora", series: "3", rept: "8 a 12", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Flexora", series: "4", rept: "12 a 15", descanso: "90 seg", method: "Drop Set 1 descida" }, { name: "Stiff", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Cadeira Abdutora", series: "3", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Elevação Pélvica com Barra", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Panturrilha em Pé Máquina", series: "5", rept: "15 a 20", descanso: "90 seg", method: "Convencional" } ] } } },
            "phase3": { title: "Fase 3: Mais Volume e Técnicas", weeks: [7, 8, 9, 10], schedule: { "Seg": "A", "Ter": "B", "Qua": "C", "Qui": "OFF", "Sex": "D", "Sáb": "E", "Dom": "OFF" }, workouts: { "A": { name: "Treino A - Ombros", exercises: [ { name: "Desenvolvimento Máquina", series: "4", rept: "20/18/15/12", descanso: "1 Min", method: "Pirâmide Crescente" }, { name: "Elevação Lateral na Polia", series: "4", rept: "8 a 12", descanso: "1 Min", method: "Rest Pause Última Série" }, { name: "Elevação Lateral com Halter", series: "4", rept: "15 a 20", descanso: "1 Min", method: "Drop Set Todas as Séries" }, { name: "Elevação Frontal na Polia", series: "4", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Elevação Frontal Barra", series: "4", rept: "15 a 20", descanso: "1 Min", method: "Rest Pause Última Série" }, { name: "Crucifixo Inverso Máquina", series: "4", rept: "8 a 12", descanso: "1 Min", method: "Convencional" }, { name: "Pull Face", series: "4", rept: "15 a 20", descanso: "1 Min", method: "Drop Set Todas as Séries" } ] }, "B": { name: "Treino B - Quadríceps", exercises: [ { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Leg Press 45", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Agachamento Hack", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Agachamento Smith", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Cadeira Adutora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Convencional" }, { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Drop Set Todas as Séries" }, { name: "Panturrilha em Pé Máquina", series: "6", rept: "15 a 20", descanso: "45 seg", method: "Convencional" } ] }, "C": { name: "Treino C - Costas e Bíceps", exercises: [ { name: "Puxada Frente Aberta", series: "4", rept: "20/18/15/12", descanso: "60 seg", method: "Pirâmide Crescente" }, { name: "Barra Fixa", series: "4", rept: "Falha", descanso: "60 seg", method: "Rest Pause Última Série" }, { name: "Remada na Máquina Articulada", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Remada Baixa Triângulo", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set Todas as Séries" }, { name: "Remada Pronada na Máquina", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Rosca Direta Barra W", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Rosca Scott na Máquina com Barra W", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Rest Pause Última Série" }, { name: "Rosca Spider com Barra W", series: "3", rept: "15 a 20", descanso: "60 seg", method: "Drop Set Todas as Séries" } ] }, "D": { name: "Treino D - Peito e Tríceps", exercises: [ { name: "Supino Inclinado Máquina", series: "4", rept: "20/18/15/12", descanso: "60 seg", method: "Pirâmide Crescente" }, { name: "Crucifixo Inclinado", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Convencional" }, { name: "Supino Reto Máquina", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Crucifixo Máquina Reto", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set 1 descida" }, { name: "Tríceps Francês Corda", series: "3", rept: "8 a 12", descanso: "60 seg", method: "Convencional" }, { name: "Tríceps Paralela", series: "4", rept: "8 a 12", descanso: "60 seg", method: "Rest Pause Última Série" }, { name: "Tríceps Corda", series: "4", rept: "15 a 20", descanso: "60 seg", method: "Drop Set Todas as Séries" } ] }, "E": { name: "Treino E - Posterior e Glúteo", exercises: [ { name: "Mesa Flexora", series: "4", rept: "8 a 12", descanso: "90 seg", method: "Rest Pause Última Série" }, { name: "Cadeira Flexora", series: "4", rept: "12 a 15", descanso: "90 seg", method: "Drop Set Todas as Séries" }, { name: "Stiff", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Cadeira Abdutora", series: "4", rept: "15 a 20", descanso: "90 seg", method: "Rest Pause Última Série" }, { name: "Elevação Pélvica com Barra", series: "4", rept: "20/18/15/12", descanso: "90 seg", method: "Pirâmide Crescente" }, { name: "Panturrilha em Pé Máquina", series: "5", rept: "15 a 20", descanso: "90 seg", method: "Convencional" } ] } } },
            "phase4": { title: "Fase 4: Método MAIS CINCO", weeks: [11, 12], schedule: { "Seg": "A", "Ter": "B", "Qua": "C", "Qui": "OFF", "Sex": "D", "Sáb": "E", "Dom": "OFF" }, workouts: { "A": { name: "Treino A - Ombros", exercises: [ { name: "Desenvolvimento Máquina", series: "4", rept: "20/18/15/12", descanso: "90 Seg", method: "Pirâmide + MAIS CINCO" }, { name: "Elevação Lateral Polia", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Elevação Lateral com Halter", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Elevação Frontal na Polia", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Elevação Frontal Barra", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Crucifixo Inverso Máquina", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Pull Face", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" } ] }, "B": { name: "Treino B - Quadríceps", exercises: [ { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Leg Press 45", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Agachamento Hack", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Agachamento Smith", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Cadeira Adutora", series: "4", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Cadeira Extensora", series: "4", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Panturrilha em Pé Máquina", series: "6", rept: "15 a 20", descanso: "45 seg", method: "MAIS CINCO" } ] }, "C": { name: "Treino C - Costas e Bíceps", exercises: [ { name: "Puxada Frente Aberta", series: "4", rept: "20/18/15/12", descanso: "90 Seg", method: "Pirâmide + MAIS CINCO" }, { name: "Barra Fixa", series: "4", rept: "Falha", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Remada na Máquina Articulada", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Remada Baixa Triângulo", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Remada Pronada na Máquina", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Rosca Direta Barra W", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Rosca Scott na Máquina com Barra W", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Rosca Spider com Barra W", series: "3", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" } ] }, "D": { name: "Treino D - Peito e Tríceps", exercises: [ { name: "Supino Inclinado Máquina", series: "4", rept: "20/18/15/12", descanso: "90 Seg", method: "Pirâmide + MAIS CINCO" }, { name: "Crucifixo Inclinado", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Supino Reto Máquina", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Crucifixo Máquina Reto", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Tríceps Francês Corda", series: "3", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Tríceps Paralela", series: "4", rept: "8 a 12", descanso: "90 Seg", method: "MAIS CINCO" }, { name: "Tríceps Corda", series: "4", rept: "15 a 20", descanso: "90 Seg", method: "MAIS CINCO" } ] }, "E": { name: "Treino E - Posterior e Glúteo", exercises: [ { name: "Mesa Flexora", series: "4", rept: "8 a 12", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Cadeira Flexora", series: "4", rept: "12 a 15", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Stiff", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Cadeira Abdutora", series: "4", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" }, { name: "Elevação Pélvica com Barra", series: "4", rept: "20/18/15/12", descanso: "2 Min", method: "Pirâmide + MAIS CINCO" }, { name: "Panturrilha em Pé Máquina", series: "5", rept: "15 a 20", descanso: "2 Min", method: "MAIS CINCO" } ] } } }
        };

        const appState = {
            currentWeekNumber: 1,
            currentDay: 'Seg',
            highestUnlockedWeek: 1,
            highestUnlockedDayIndex: 0, 
            completionStatus: {}
        };

        const dom = {
            stepperNav: document.getElementById('stepper-nav'),
            daySelector: document.getElementById('day-selector'),
            workoutDetails: document.getElementById('workout-details'),
            workoutTitle: document.getElementById('workout-title'),
            progressBarContainer: document.getElementById('progress-bar-container'),
            phaseHeader: document.getElementById('phase-header'),
            footer: document.getElementById('footer-container'),
            completeWorkoutBtn: document.getElementById('complete-workout-btn')
        };
        
        const confettiCanvas = document.getElementById('confetti-canvas');
        const myConfetti = confetti.create(confettiCanvas, {
            resize: true,
            useWorker: true
        });

        // --- Utility Functions ---
        function showCompletionMessage() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/70 flex items-center justify-center z-[200] p-4';
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-8 text-center border border-gray-700 shadow-2xl animate-fadeIn">
                    <h2 class="text-3xl font-bold text-orange-500 mb-4">Parabéns!</h2>
                    <p class="text-white text-lg mb-6">Você concluiu o programa de 12 semanas!</p>
                    <button id="close-modal-btn" class="bg-orange-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-orange-700">Fechar</button>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('close-modal-btn').addEventListener('click', () => {
                modal.remove();
            });
        }
        
        function resetState() {
            localStorage.removeItem('workoutProgress');
            appState.currentWeekNumber = 1;
            appState.currentDay = 'Seg';
            appState.highestUnlockedWeek = 1;
            appState.highestUnlockedDayIndex = 0;
            appState.completionStatus = {};
            console.warn("State was reset due to invalid saved data.");
        }

        // --- State Management ---
        function saveState() {
            localStorage.setItem('workoutProgress', JSON.stringify({
                highestUnlockedWeek: appState.highestUnlockedWeek,
                highestUnlockedDayIndex: appState.highestUnlockedDayIndex,
            }));
        }

        function loadState() {
            try {
                const savedStateJSON = localStorage.getItem('workoutProgress');
                if (!savedStateJSON) return;

                const savedState = JSON.parse(savedStateJSON);
                
                if (typeof savedState !== 'object' || savedState === null ||
                    typeof savedState.highestUnlockedWeek !== 'number' ||
                    typeof savedState.highestUnlockedDayIndex !== 'number') {
                    throw new Error("Invalid state structure.");
                }
                
                let week = savedState.highestUnlockedWeek;
                if (week < 1 || week > 12) {
                     throw new Error("Invalid week number.");
                }

                const phaseData = getPhaseDataByWeek(week);
                if (!phaseData) {
                    throw new Error(`No phase data found for week ${week}.`);
                }

                const dayKeys = Object.keys(phaseData.schedule);
                let dayIndex = savedState.highestUnlockedDayIndex;
                if (dayIndex < 0 || dayIndex >= dayKeys.length) {
                    dayIndex = 0;
                }
                
                appState.highestUnlockedWeek = week;
                appState.currentWeekNumber = week;
                appState.highestUnlockedDayIndex = dayIndex;
                appState.currentDay = dayKeys[dayIndex];

            } catch (error) {
                console.error("Failed to load or validate state from localStorage. Resetting.", error);
                resetState();
            }
        }
        
        function getPhaseDataByWeek(weekNumber) {
            for (const phaseKey in workoutPhases) {
                const phase = workoutPhases[phaseKey];
                if (phase.weeks.includes(weekNumber)) {
                    return phase;
                }
            }
            return null;
        }

        // --- Rendering Functions ---
        function renderStepperNav() {
            dom.stepperNav.innerHTML = '';
            const container = document.createElement('div');
            container.className = 'relative w-full px-2';

            const track = document.createElement('div');
            track.className = 'absolute top-1/2 -translate-y-1/2 left-0 w-full h-1 bg-gray-700 rounded-full';
            container.appendChild(track);

            const progressFill = document.createElement('div');
            const progressPercentage = appState.highestUnlockedWeek > 1 ? ((appState.highestUnlockedWeek - 1) / 11) * 100 : 0;
            progressFill.className = 'absolute top-1/2 -translate-y-1/2 left-0 h-1 bg-orange-500 rounded-full transition-all duration-500';
            progressFill.style.width = `${progressPercentage}%`;
            container.appendChild(progressFill);

            const markersContainer = document.createElement('div');
            markersContainer.className = 'relative flex justify-between items-center';
            
            for (let i = 1; i <= 12; i++) {
                const weekNumber = i;
                const isLocked = weekNumber > appState.highestUnlockedWeek;
                
                const markerWrapper = document.createElement('div');
                markerWrapper.className = `group relative flex flex-col items-center p-2 ${isLocked ? 'cursor-not-allowed' : 'cursor-pointer'}`;
                
                if (!isLocked) {
                    markerWrapper.addEventListener('click', () => {
                        appState.currentWeekNumber = weekNumber;
                        const newPhaseData = getPhaseDataByWeek(weekNumber);
                        const dayKeys = Object.keys(newPhaseData.schedule);
                        appState.currentDay = weekNumber === appState.highestUnlockedWeek ? dayKeys[appState.highestUnlockedDayIndex] : dayKeys[0];
                        appState.completionStatus = {};
                        renderAll();
                    });
                }

                const marker = document.createElement('div');
                let markerClasses = 'w-3 h-3 rounded-full transition-all duration-300 flex items-center justify-center';
                if (weekNumber === appState.currentWeekNumber) {
                    markerClasses += ' bg-white border-2 border-orange-500 scale-150 ring-2 ring-white';
                } else if (weekNumber < appState.highestUnlockedWeek) {
                    markerClasses += ' bg-orange-500';
                } else {
                    markerClasses += isLocked ? ' bg-gray-800 border-2 border-gray-600' : ' bg-gray-600';
                }
                if(isLocked) {
                    marker.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500 -mt-0.5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" /></svg>`;
                    markerClasses += ' w-6 h-6';
                }
                marker.className = markerClasses;
                
                const tooltip = document.createElement('span');
                tooltip.className = 'step-tooltip absolute bottom-full mb-2 px-2 py-1 text-xs font-semibold text-white bg-gray-700 rounded-md shadow-lg whitespace-nowrap';
                tooltip.textContent = `Semana ${weekNumber}`;
                
                markerWrapper.appendChild(tooltip);
                markerWrapper.appendChild(marker);
                markersContainer.appendChild(markerWrapper);
            }
            
            container.appendChild(markersContainer);
            dom.stepperNav.appendChild(container);
        }

        function renderPhaseHeader() {
            const phaseData = getPhaseDataByWeek(appState.currentWeekNumber);
            if (!phaseData) return;
            dom.phaseHeader.innerHTML = `
                <h2 class="text-xl font-bold text-orange-400">${phaseData.title}</h2>
                <p class="text-gray-400 font-semibold">Semana ${appState.currentWeekNumber} de 12</p>
            `;
        }

        function renderDaySelector() {
            const phaseData = getPhaseDataByWeek(appState.currentWeekNumber);
            const dayKeys = Object.keys(phaseData.schedule);
            dom.daySelector.innerHTML = '';

            dayKeys.forEach((day, index) => {
                const isLocked = appState.currentWeekNumber === appState.highestUnlockedWeek && index > appState.highestUnlockedDayIndex;
                const workoutLetter = phaseData.schedule[day];
                const button = document.createElement('button');
                button.textContent = day;
                let buttonClasses = `px-3 py-1.5 text-sm rounded-md font-semibold transition-colors duration-200 flex-grow text-center `;

                if (isLocked || workoutLetter === 'OFF') {
                    buttonClasses += 'bg-gray-800 text-gray-500 cursor-not-allowed';
                    button.disabled = true;
                } else if (appState.currentDay === day) {
                    buttonClasses += 'bg-orange-600 text-white';
                } else {
                    buttonClasses += 'bg-gray-700 text-gray-400 hover:bg-gray-600';
                }

                button.className = buttonClasses;

                if (!isLocked && workoutLetter !== 'OFF') {
                    button.addEventListener('click', () => {
                        appState.currentDay = day;
                        appState.completionStatus = {};
                        renderWorkout();
                    });
                }
                dom.daySelector.appendChild(button);
            });
        }

        function renderWorkout() {
            const phaseData = getPhaseDataByWeek(appState.currentWeekNumber);
            if (!phaseData) return; 
            const workoutLetter = phaseData.schedule[appState.currentDay];
            dom.workoutDetails.innerHTML = '';
            dom.workoutTitle.innerHTML = '';
            dom.progressBarContainer.innerHTML = '';
            dom.footer.style.display = 'none';

            if (workoutLetter === 'OFF' || !phaseData.workouts[workoutLetter]) {
                dom.workoutTitle.innerHTML = `<h2 class="text-2xl font-bold text-gray-400">Dia de Descanso</h2>`;
                return;
            }
            
            dom.footer.style.display = 'block';

            const workout = phaseData.workouts[workoutLetter];
            dom.workoutTitle.innerHTML = `<h2 class="text-3xl font-bold text-white">${workout.name}</h2>`;
            
            const totalExercises = workout.exercises.length;
            const completedExercises = Object.values(appState.completionStatus).filter(Boolean).length;
            const progress = totalExercises > 0 ? (completedExercises / totalExercises) * 100 : 0;
            
            dom.completeWorkoutBtn.disabled = completedExercises < totalExercises;

            dom.progressBarContainer.innerHTML = `
                <div class="flex justify-between items-center mb-1 text-sm font-semibold">
                    <span class="text-gray-400">Progresso do Treino</span>
                    <span class="text-white">${completedExercises} / ${totalExercises}</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2.5">
                    <div class="bg-orange-500 h-2.5 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                </div>
            `;

            workout.exercises.forEach((exercise, index) => {
                const isCompleted = appState.completionStatus[index];
                const card = document.createElement('div');
                card.className = `bg-gray-800 rounded-xl shadow-lg border border-gray-700 transition-all duration-300 flex flex-col ${isCompleted ? 'exercise-completed' : ''}`;
                
                let imageUrl;
                if (exercise.name === 'Elevação Lateral na Polia') {
                    imageUrl = 'imagens/Elevação Lateral na Polia.gif';
                } else if (exercise.name === 'Pulley Frente Aberto') {
                    imageUrl = 'imagens/Pulley Frente Aberto.gif';
                } else if (exercise.name === 'Puxada Triângulo') {
                    imageUrl = 'imagens/Puxada Triângulo.gif';
                } else if (exercise.name === 'Remada Serrote') {
                    imageUrl = 'imagens/Remada Serrote.gif';
                } else if (exercise.name === 'Remada Baixa Triângulo') {
                    imageUrl = 'imagens/Remada Baixa Triângulo.gif';
                } else if (exercise.name === 'Rosca Direta Barra Reta') {
                    imageUrl = 'imagens/Rosca Direta Barra Reta.gif';
                } else if (exercise.name === 'Tríceps Corda') {
                    imageUrl = 'imagens/Tríceps Corda.gif';
                } else if (exercise.name === 'Rosca Martelo + Tríceps Francês (Corda)') {
                    imageUrl = 'imagens/Rosca Martelo + Tríceps Francês (Corda).gif';
                } else if (exercise.name === 'Desenvolvimento Máquina') {
                    imageUrl = 'imagens/Desenvolvimento Máquina.gif';
                } else if (exercise.name === 'Cadeira Extensora') {
                    imageUrl = 'imagens/Cadeira Extensora.gif';
                } else if (exercise.name === 'Leg Press 45') {
                    imageUrl = 'imagens/Leg Press 45.gif';
                } else if (exercise.name === 'Cadeira Adutora') {
                    imageUrl = 'imagens/Cadeira Adutora.gif';
                } else if (exercise.name === 'Cadeira Extensora (2)') {
                    imageUrl = 'imagens/Cadeira Extensora (2).gif';
                } else if (exercise.name === 'Cadeira Flexora') {
                    imageUrl = 'imagens/Cadeira Flexora.gif';
                } else if (exercise.name === 'Cadeira Abdutora') {
                    imageUrl = 'imagens/Cadeira Abdutora.gif';
                } else if (exercise.name === 'Supino Inclinado Máquina') {
                    imageUrl = 'imagens/Supino Inclinado Máquina.gif';
                } else if (exercise.name === 'Crucifixo Inclinado') {
                    imageUrl = 'imagens/Crucifixo Inclinado.gif';
                } else if (exercise.name === 'Supino Reto Máquina') {
                    imageUrl = 'imagens/Supino Reto Máquina.gif';
                } else if (exercise.name === 'Desenvolvimento Máquina Aberto') {
                    imageUrl = 'imagens/Desenvolvimento Máquina Aberto.gif';
                } else if (exercise.name === 'Elevação Lateral') {
                    imageUrl = 'imagens/Elevação Lateral.gif';
                } else if (exercise.name === 'Tríceps Paralela') {
                    imageUrl = 'imagens/Tríceps Paralela.gif';
                } else if (exercise.name === 'Elevação Lateral com Halter') {
                    imageUrl = 'imagens/Elevação Lateral com Halter.gif';
                } else if (exercise.name === 'Elevação Frontal na Polia') {
                    imageUrl = 'imagens/Elevação Frontal na Polia.gif';
                } else if (exercise.name === 'Elevação Frontal Barra') {
                    imageUrl = 'imagens/Elevação Frontal Barra.gif';
                } else if (exercise.name === 'Crucifixo Inverso Máquina') { 
                    imageUrl = 'imagens/Crucifixo Inverso Máquina.gif';
                } else if (exercise.name === 'Pull Face') {
                    imageUrl = 'imagens/Pull Face.gif';
                } else if (exercise.name === 'Puxada Frente Aberta') {
                    imageUrl = 'imagens/Puxada Frente Aberta.gif';
                } else if (exercise.name === 'Barra Fixa') {
                    imageUrl = 'imagens/Barra Fixa.gif';
                } else if (exercise.name === 'Remada na Máquina Articulada') {
                    imageUrl = 'imagens/Remada na Máquina Articulada.gif';
                } else if (exercise.name === 'Remada Pronada na Máquina') {
                    imageUrl = 'imagens/Remada Pronada na Máquina.gif';
                } else if (exercise.name === 'Rosca Direta Barra W') {
                    imageUrl = 'imagens/Rosca Direta Barra W.gif';
                } else if (exercise.name === 'Rosca Scott na Máquina com Barra W') {
                    imageUrl = 'imagens/Rosca Scott na Máquina com Barra W.gif';
                } else if (exercise.name === 'Rosca Spider com Barra W') {
                    imageUrl = 'imagens/Rosca Spider com Barra W.gif';
                } else if (exercise.name === 'Tríceps Francês Corda') {
                    imageUrl = 'imagens/Tríceps Francês Corda.gif';
                } else if (exercise.name === 'Mesa Flexora') {
                    imageUrl = 'imagens/Mesa Flexora.gif';
                } else if (exercise.name === 'Stiff') {
                    imageUrl = 'imagens/Stiff.gif';
                } else if (exercise.name === 'Elevação Pélvica com Barra') {
                    imageUrl = 'imagens/Elevação Pélvica com Barra.gif';
                } else if (exercise.name === 'Panturrilha em Pé Máquina') {
                    imageUrl = 'imagens/Panturrilha em Pé Máquina.gif';
                } else if (exercise.name === 'Agachamento Hack') {
                    imageUrl = 'imagens/Agachamento Hack.gif';
                } else if (exercise.name === 'Crucifixo Máquina Reto') {
                    imageUrl = 'imagens/Crucifixo Máquina Reto.gif';
                } else if (exercise.name === 'Agachamento Smith') {
                    imageUrl = 'imagens/Agachamento Smith.gif';
                } else if (exercise.name === 'Elevação Lateral Polia') {
                    imageUrl = 'imagens/Elevação Lateral Polia.gif';
                } else {
                    imageUrl = `https://placehold.co/100x100/1f2937/FFFFFF?text=${encodeURIComponent(exercise.name.split(' ')[0])}&font=inter`;
                }

                card.innerHTML = `
                    <div class="p-5 flex flex-col items-center w-full">
                        <img src="${imageUrl}" alt="Ilustração do exercício" class="w-64 h-64 md:w-72 md:h-72 object-cover rounded-xl mb-6 shadow-xl border-4 border-orange-500/20">
                        <h3 class="text-2xl font-bold text-white text-center mb-6">${exercise.name}</h3>

                        <div class="w-full grid grid-cols-2 gap-3 text-center mb-6">
                            <div class="bg-gray-900/50 p-3 rounded-lg">
                                <span class="text-xs uppercase text-gray-400 font-semibold tracking-wider">Séries</span>
                                <p class="font-bold text-lg text-white">${exercise.series}</p>
                            </div>
                            <div class="bg-gray-900/50 p-3 rounded-lg">
                                <span class="text-xs uppercase text-gray-400 font-semibold tracking-wider">Reps</span>
                                <p class="font-bold text-lg text-white">${exercise.rept}</p>
                            </div>
                            <div class="bg-gray-900/50 p-3 rounded-lg">
                                <span class="text-xs uppercase text-gray-400 font-semibold tracking-wider">Descanso</span>
                                <p class="font-bold text-lg text-white">${exercise.descanso}</p>
                            </div>
                            <div class="bg-orange-600/20 text-orange-400 p-3 rounded-lg border border-orange-500/30">
                                <span class="text-xs uppercase font-semibold tracking-wider">Método</span>
                                <p class="font-bold text-lg">${exercise.method}</p>
                            </div>
                        </div>
                        
                         <button class="complete-btn w-full whitespace-nowrap py-3 rounded-lg font-bold text-base transition-all duration-300 transform hover:scale-105 flex items-center justify-center gap-2 ${isCompleted ? 'bg-green-600 text-white shadow-lg shadow-green-600/20' : 'bg-orange-500 hover:bg-orange-600 text-white shadow-lg shadow-orange-500/20'}">
                            ${isCompleted ? '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg> Concluído' : 'Marcar como Concluído'}
                        </button>
                    </div>
                `;

                card.querySelector('.complete-btn').addEventListener('click', () => {
                    appState.completionStatus[index] = !appState.completionStatus[index];
                    renderWorkout();
                });
                
                dom.workoutDetails.appendChild(card);
            });
        }
        
        // --- Event Handlers & Initialization ---
        function handleCompleteWorkout() {
            myConfetti({
                particleCount: 150,
                spread: 90,
                origin: { y: 0.6 },
                colors: ['#f97316', '#fb923c', '#fed7aa', '#ffffff']
            });

            const phaseData = getPhaseDataByWeek(appState.currentWeekNumber);
            const dayKeys = Object.keys(phaseData.schedule);
            const currentDayIndex = dayKeys.indexOf(appState.currentDay);

            let nextDayIndex = currentDayIndex + 1;
            while(nextDayIndex < dayKeys.length && phaseData.schedule[dayKeys[nextDayIndex]] === 'OFF') {
                nextDayIndex++;
            }
            
            let isLastTrainingDay = !dayKeys.slice(currentDayIndex + 1).some(day => phaseData.schedule[day] !== 'OFF');

            if (isLastTrainingDay) {
                if (appState.highestUnlockedWeek < 12) {
                    appState.highestUnlockedWeek++;
                    appState.highestUnlockedDayIndex = 0;
                    appState.currentWeekNumber = appState.highestUnlockedWeek;
                    const nextPhaseData = getPhaseDataByWeek(appState.currentWeekNumber);
                    appState.currentDay = Object.keys(nextPhaseData.schedule)[0];
                } else {
                    showCompletionMessage();
                }
            } else {
                 appState.highestUnlockedDayIndex = nextDayIndex;
                 appState.currentDay = dayKeys[nextDayIndex];
            }

            appState.completionStatus = {};
            saveState();
            
            setTimeout(() => {
                renderAll();
                window.scrollTo(0, 0);
            }, 300);
        }
        
        function renderAll() {
            renderStepperNav();
            renderPhaseHeader();
            renderDaySelector();
            renderWorkout();
        }
        
        dom.completeWorkoutBtn.addEventListener('click', handleCompleteWorkout);

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize workout app
            loadState();
            renderAll();
            
            // --- MODERN PLAYER LOGIC ---
            const mainContent = document.getElementById('main-content');
            const openPlayerBtn = document.getElementById('open-player-btn');
            const closePlayerBtn = document.getElementById('close-player-btn');
            const playerModal = document.getElementById('player-modal');
            const playerCard = document.getElementById('player-card');
            const audio = document.getElementById('audio-player');
            
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');
            const volumeSlider = document.getElementById('volume-slider');

            // Modal Logic
            const openModal = () => {
                playerModal.classList.remove('invisible', 'opacity-0');
                playerCard.classList.remove('scale-95');
                mainContent.classList.add('blur-sm', 'scale-105');
            };

            const closeModal = () => {
                playerModal.classList.add('invisible', 'opacity-0');
                playerCard.classList.add('scale-95');
                mainContent.classList.remove('blur-sm', 'scale-105');
            };

            openPlayerBtn.addEventListener('click', openModal);
            closePlayerBtn.addEventListener('click', closeModal);
            playerModal.addEventListener('click', (e) => {
                if (e.target === playerModal) {
                    closeModal();
                }
            });

            // Player Logic
            let isPlaying = false;

            const togglePlay = () => {
                if (isPlaying) {
                    audio.pause();
                } else {
                    audio.play().catch(e => console.error("Erro ao tocar áudio:", e));
                }
            };
            
            const updatePlayPauseIcon = () => {
                playIcon.classList.toggle('hidden', isPlaying);
                pauseIcon.classList.toggle('hidden', !isPlaying);
            };

            const setVolume = () => {
                audio.volume = volumeSlider.value;
            };

            // Event Listeners for Player
            playPauseBtn.addEventListener('click', togglePlay);
            audio.addEventListener('play', () => { isPlaying = true; updatePlayPauseIcon(); });
            audio.addEventListener('pause', () => { isPlaying = false; updatePlayPauseIcon(); });
            volumeSlider.addEventListener('input', setVolume);

            // Set initial volume
            setVolume();
        });
    </script>
</body>
</html>

